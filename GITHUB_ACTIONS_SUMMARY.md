# GitHub Actions è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒæ€»ç»“

## ğŸ‰ å®Œæˆçš„ GitHub Actions å·¥ä½œæµ

æˆ‘å·²ç»ä¸º png2icns é¡¹ç›®æ·»åŠ äº†å®Œæ•´çš„ GitHub Actions CI/CD æµç¨‹ï¼Œå®ç°äº†è‡ªåŠ¨æ„å»ºå¹¶ä¸Šä¼ åˆ¶å“çš„åŠŸèƒ½ã€‚

### âœ… å·²å®ç°çš„å·¥ä½œæµ

#### 1. **CI å·¥ä½œæµ** (`.github/workflows/ci.yml`)
- **è§¦å‘æ¡ä»¶**: Pushã€PRã€å®šæ—¶ä»»åŠ¡
- **åŠŸèƒ½**:
  - ä»£ç è´¨é‡æ£€æŸ¥ (rustfmt, clippy)
  - å¤šå¹³å°æµ‹è¯• (Ubuntu, macOS)
  - Docker åŠŸèƒ½æµ‹è¯•
  - å®‰å…¨å®¡è®¡ (cargo audit)
  - ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
  - æ€§èƒ½åŸºå‡†æµ‹è¯•

#### 2. **æ„å»ºå’Œå‘å¸ƒå·¥ä½œæµ** (`.github/workflows/build-and-release.yml`)
- **è§¦å‘æ¡ä»¶**: Pushã€åˆ›å»ºæ ‡ç­¾ã€PR
- **åŠŸèƒ½**:
  - å¤šå¹³å°äºŒè¿›åˆ¶æ„å»º (Linux x86_64, Linux musl, macOS x86_64, macOS ARM64)
  - å¤šæ¶æ„ Docker é•œåƒæ„å»º (linux/amd64, linux/arm64)
  - è‡ªåŠ¨åˆ›å»º GitHub Release
  - ä¸Šä¼ äºŒè¿›åˆ¶åˆ¶å“å’Œæ ¡éªŒå’Œ
  - å®‰å…¨æ‰«æ

#### 3. **Docker å‘å¸ƒå·¥ä½œæµ** (`.github/workflows/docker-publish.yml`)
- **è§¦å‘æ¡ä»¶**: Push åˆ°ä¸»åˆ†æ”¯ã€åˆ›å»ºæ ‡ç­¾ã€å®šæ—¶ä»»åŠ¡
- **åŠŸèƒ½**:
  - æ„å»ºå¤šæ¶æ„ Docker é•œåƒ
  - æ¨é€åˆ° GitHub Container Registry (ghcr.io)
  - ç”Ÿæˆ SBOM (è½¯ä»¶ç‰©æ–™æ¸…å•)
  - Trivy å®‰å…¨æ‰«æ
  - è‡ªåŠ¨æ›´æ–°æ–‡æ¡£

#### 4. **æ¸…ç†å·¥ä½œæµ** (`.github/workflows/cleanup.yml`)
- **è§¦å‘æ¡ä»¶**: å®šæ—¶ä»»åŠ¡ã€æ‰‹åŠ¨è§¦å‘
- **åŠŸèƒ½**:
  - æ¸…ç†æ—§çš„å®¹å™¨é•œåƒ
  - æ¸…ç†æ—§çš„æ„å»ºåˆ¶å“
  - æ¸…ç†æ—§çš„æ„å»ºç¼“å­˜

### ğŸ—ï¸ é¡¹ç›®ç»“æ„å¢å¼º

```
png2icns/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ ci.yml                    # æŒç»­é›†æˆ
â”‚   â”‚   â”œâ”€â”€ build-and-release.yml     # æ„å»ºå’Œå‘å¸ƒ
â”‚   â”‚   â”œâ”€â”€ docker-publish.yml        # Docker å‘å¸ƒ
â”‚   â”‚   â””â”€â”€ cleanup.yml               # æ¸…ç†ä»»åŠ¡
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE/
â”‚   â”‚   â”œâ”€â”€ bug_report.md             # Bug æŠ¥å‘Šæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ feature_request.md        # åŠŸèƒ½è¯·æ±‚æ¨¡æ¿
â”‚   â”œâ”€â”€ CONTRIBUTING.md               # è´¡çŒ®æŒ‡å—
â”‚   â”œâ”€â”€ pull_request_template.md      # PR æ¨¡æ¿
â”‚   â””â”€â”€ WORKFLOWS.md                  # å·¥ä½œæµè¯´æ˜
â”œâ”€â”€ src/main.rs                       # ä¸»ç¨‹åº
â”œâ”€â”€ Dockerfile                        # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ Cargo.toml                        # Rust é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md                         # é¡¹ç›®æ–‡æ¡£ (å·²æ›´æ–°)
â””â”€â”€ Makefile                          # æ„å»ºè„šæœ¬ (å·²å¢å¼º)
```

### ğŸš€ è‡ªåŠ¨åŒ–æµç¨‹

#### å¼€å‘æµç¨‹
1. **å¼€å‘**: åœ¨åŠŸèƒ½åˆ†æ”¯å¼€å‘ä»£ç 
2. **æäº¤**: åˆ›å»º Pull Request
3. **CI**: è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•å’Œæ£€æŸ¥
4. **åˆå¹¶**: åˆå¹¶åˆ°ä¸»åˆ†æ”¯
5. **å‘å¸ƒ**: åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾è§¦å‘è‡ªåŠ¨å‘å¸ƒ

#### å‘å¸ƒæµç¨‹
```bash
# åˆ›å»ºæ–°ç‰ˆæœ¬
git tag v1.0.0
git push origin v1.0.0

# GitHub Actions è‡ªåŠ¨æ‰§è¡Œï¼š
# 1. æ„å»ºå¤šå¹³å°äºŒè¿›åˆ¶æ–‡ä»¶
# 2. æ„å»ºå¤šæ¶æ„ Docker é•œåƒ
# 3. åˆ›å»º GitHub Release
# 4. ä¸Šä¼ æ‰€æœ‰åˆ¶å“
# 5. æ¨é€ Docker é•œåƒåˆ° GHCR
```

### ğŸ“¦ åˆ¶å“è¾“å‡º

#### äºŒè¿›åˆ¶æ–‡ä»¶
- `png2icns-linux-x86_64.tar.gz` - Linux x86_64 (glibc)
- `png2icns-linux-x86_64-musl.tar.gz` - Linux x86_64 (musl)
- `png2icns-macos-x86_64.tar.gz` - macOS Intel
- `png2icns-macos-aarch64.tar.gz` - macOS Apple Silicon

#### Docker é•œåƒ
- `ghcr.io/your-username/png2icns:latest` - æœ€æ–°ç‰ˆæœ¬
- `ghcr.io/your-username/png2icns:v1.0.0` - ç‰¹å®šç‰ˆæœ¬
- `ghcr.io/your-username/png2icns:main` - ä¸»åˆ†æ”¯ç‰ˆæœ¬

#### æ ¡éªŒå’Œå’Œå®‰å…¨
- SHA256 æ ¡éªŒå’Œæ–‡ä»¶
- SBOM (è½¯ä»¶ç‰©æ–™æ¸…å•)
- Trivy å®‰å…¨æ‰«ææŠ¥å‘Š

### ğŸ”§ ä½¿ç”¨æ–¹æ³•

#### ä½¿ç”¨é¢„æ„å»ºé•œåƒ
```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull ghcr.io/your-username/png2icns:latest

# ä½¿ç”¨
docker run --rm \
  -v $(pwd)/input:/app/input \
  -v $(pwd)/output:/app/output \
  ghcr.io/your-username/png2icns:latest \
  -i /app/input/icon.png \
  -o /app/output/icon.icns
```

#### ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
```bash
# ä» GitHub Releases ä¸‹è½½
wget https://github.com/your-username/png2icns/releases/latest/download/png2icns-linux-x86_64.tar.gz
tar -xzf png2icns-linux-x86_64.tar.gz
chmod +x png2icns-linux-x86_64
sudo mv png2icns-linux-x86_64 /usr/local/bin/png2icns
```

#### ä½¿ç”¨ Makefile
```bash
# æŸ¥çœ‹ GitHub Actions çŠ¶æ€
make gh-status

# åˆ›å»ºæ–°å‘å¸ƒ
make gh-release

# æ‹‰å–æœ€æ–°é•œåƒ
make gh-pull-image
```

### ğŸ“Š CI/CD ç‰¹æ€§

#### è´¨é‡ä¿è¯
- âœ… ä»£ç æ ¼å¼æ£€æŸ¥ (rustfmt)
- âœ… é™æ€åˆ†æ (clippy)
- âœ… å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… å¤šå¹³å°å…¼å®¹æ€§æµ‹è¯•
- âœ… Docker åŠŸèƒ½æµ‹è¯•
- âœ… å®‰å…¨å®¡è®¡ (cargo audit)
- âœ… æ¼æ´æ‰«æ (Trivy)

#### è‡ªåŠ¨åŒ–å‘å¸ƒ
- âœ… å¤šå¹³å°äºŒè¿›åˆ¶æ„å»º
- âœ… å¤šæ¶æ„ Docker é•œåƒ
- âœ… è‡ªåŠ¨ç‰ˆæœ¬æ ‡è®°
- âœ… GitHub Release åˆ›å»º
- âœ… åˆ¶å“ä¸Šä¼ å’Œåˆ†å‘
- âœ… å®¹å™¨é•œåƒæ¨é€

#### ç»´æŠ¤å’Œæ¸…ç†
- âœ… å®šæœŸæ¸…ç†æ—§åˆ¶å“
- âœ… ç¼“å­˜ç®¡ç†
- âœ… é•œåƒç‰ˆæœ¬ç®¡ç†
- âœ… è‡ªåŠ¨åŒ–ç»´æŠ¤ä»»åŠ¡

### ğŸ¯ ä¼˜åŠ¿

1. **é›¶æ‰‹åŠ¨æ“ä½œ**: å®Œå…¨è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œå‘å¸ƒæµç¨‹
2. **å¤šå¹³å°æ”¯æŒ**: æ”¯æŒ Linux å’Œ macOS çš„å¤šç§æ¶æ„
3. **é«˜è´¨é‡ä¿è¯**: å…¨é¢çš„æµ‹è¯•å’Œæ£€æŸ¥æµç¨‹
4. **å®‰å…¨æ€§**: è‡ªåŠ¨å®‰å…¨æ‰«æå’Œæ¼æ´æ£€æµ‹
5. **æ˜“äºç»´æŠ¤**: è‡ªåŠ¨æ¸…ç†å’Œç»´æŠ¤ä»»åŠ¡
6. **ç”¨æˆ·å‹å¥½**: é¢„æ„å»ºåˆ¶å“ï¼Œå³ä¸‹å³ç”¨

### ğŸ”® æ‰©å±•å¯èƒ½

- [ ] æ·»åŠ  Windows å¹³å°æ”¯æŒ
- [ ] é›†æˆæ›´å¤šå®‰å…¨æ‰«æå·¥å…·
- [ ] æ·»åŠ æ€§èƒ½å›å½’æµ‹è¯•
- [ ] å®ç°è‡ªåŠ¨ä¾èµ–æ›´æ–°
- [ ] æ·»åŠ å‘å¸ƒé€šçŸ¥æœºåˆ¶

### ğŸ“ ä½¿ç”¨è¯´æ˜

1. **é¦–æ¬¡è®¾ç½®**: å°†ä»£ç æ¨é€åˆ° GitHub ä»“åº“
2. **é…ç½®æƒé™**: ç¡®ä¿ GitHub Actions æœ‰å¿…è¦æƒé™
3. **åˆ›å»ºå‘å¸ƒ**: ä½¿ç”¨ `git tag v1.0.0` åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
4. **ç›‘æ§æµç¨‹**: åœ¨ GitHub Actions é¡µé¢æŸ¥çœ‹æ„å»ºçŠ¶æ€
5. **ä½¿ç”¨åˆ¶å“**: ä» Releases é¡µé¢ä¸‹è½½æˆ–ä½¿ç”¨ Docker é•œåƒ

è¿™ä¸ªå®Œæ•´çš„ CI/CD æµç¨‹ç¡®ä¿äº†é¡¹ç›®çš„é«˜è´¨é‡ã€å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ï¼Œä¸ºç”¨æˆ·æä¾›äº†å¤šç§ä½¿ç”¨æ–¹å¼ï¼ŒåŒæ—¶ä¸ºå¼€å‘è€…æä¾›äº†é«˜æ•ˆçš„å¼€å‘å’Œå‘å¸ƒä½“éªŒï¼ğŸš€